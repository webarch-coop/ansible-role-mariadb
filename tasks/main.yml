---
- name: mariadb-server, mariadb-client and other packages present
  apt:
    pkg:
      - mariadb-server
      - mariadb-client
      - mysqltuner
      - python-mysqldb
      - python3-mysqldb
      - pwgen
    state: latest
    update_cache: false
  tags:
    - mariadb

- name: Check /etc/debian_version
  shell: "lsb_release -c | awk '{ print $2 }'"
  register: mariadb_debian_version_check
  changed_when: false
  tags:
    - mariadb

- name: Set a fact for the Debian version
  set_fact:
    mariadb_debian_version: "{{ mariadb_debian_version_check.stdout }}"
  tags:
    - mariadb

- name: MariaDB defaults set
  template:
    src: templates/50-server.cnf.j2
    dest: /etc/mysql/mariadb.conf.d/50-server.cnf
    backup: true
  register: mariadb_conf
  tags:
    - mariadb

- name: MariaDB restarted
  service:
    name: mysql
    state: restarted
  when: mariadb_conf.changed
  tags:
    - mariadb

- name: Conditionally include the root password tasks
  include_tasks: mariadb_root.yml
  when: mariadb_root_password is defined and mariadb_root_password != ""
  tags:
    - mariadb

- name: Conditionally include the user and database creation tasks
  include_tasks: mariadb_user.yml
  when: mariadb_username is defined and mariadb_username != ""
  tags:
    - mariadb
...
