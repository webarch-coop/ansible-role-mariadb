---
- name: mariadb-server, mariadb-client and other packages present
  apt:
    pkg:
      - mariadb-server
      - mariadb-client
      - mysqltuner
      - python-mysqldb
      - pwgen
    state: latest
    update_cache: no
  tags:
    - mariadb

- name: MariaDB defaults set
  template:
    src: templates/50-server.cnf.j2
    dest: /etc/mysql/mariadb.conf.d/50-server.cnf
  register: mariadb_conf
  tags:
    - mariadb

- name: MariaDB restarted
  service:
    name: mysql
    state: restarted
  when: mariadb_conf.changed
  tags:
    - mariadb

- name: Conditionally include the root password tasks
  include_tasks: mariadb_root.yml
  when: mariadb_root_password is defined and mariadb_root_password != ""
  tags:
    - mariadb

- name: Conditionally include the user and database creation tasks
  include_tasks: mariadb_user.yml
  when: mariadb_username is defined and mariadb_username != ""
  tags:
    - mariadb
